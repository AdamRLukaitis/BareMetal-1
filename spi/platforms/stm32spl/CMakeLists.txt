FIND_PACKAGE(CMSIS REQUIRED)
FIND_PACKAGE(StdPeriphLib REQUIRED)

INCLUDE_DIRECTORIES(
    ${CMAKE_SOURCE_DIR}/include
    ${CMSIS_INCLUDE_DIR}
    ${StdPeriphLib_INCLUDE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}
)

SET(BAREMETAL_SPI_SOURCES
    spi_stm32spl.c
)

IF(USE_ASSERT)
    ADD_DEFINITIONS("-D\"assert_param(expr)\"=\"((expr) ? (void)0 : assert_failed((uint8_t *)__FILE__, __LINE__))\"")
ELSE()
    ADD_DEFINITIONS("-D\"assert_param(expr)\"=\"((void)0)\"")
ENDIF()

ADD_LIBRARY(bm_spi_stm32spl_cl ${BAREMETAL_SPI_SOURCES})
SET_TARGET_PROPERTIES(bm_spi_stm32spl_cl PROPERTIES COMPILE_DEFINITIONS ${STM32_CHIP_DEF_CL})

ADD_LIBRARY(bm_spi_stm32spl_hd ${BAREMETAL_SPI_SOURCES})
SET_TARGET_PROPERTIES(bm_spi_stm32spl_hd PROPERTIES COMPILE_DEFINITIONS ${STM32_CHIP_DEF_HD})

ADD_LIBRARY(bm_spi_stm32spl_hd_vl ${BAREMETAL_SPI_SOURCES})
SET_TARGET_PROPERTIES(bm_spi_stm32spl_hd_vl PROPERTIES COMPILE_DEFINITIONS ${STM32_CHIP_DEF_HD_VL})

ADD_LIBRARY(bm_spi_stm32spl_ld ${BAREMETAL_SPI_SOURCES})
SET_TARGET_PROPERTIES(bm_spi_stm32spl_ld PROPERTIES COMPILE_DEFINITIONS ${STM32_CHIP_DEF_LD})

ADD_LIBRARY(bm_spi_stm32spl_ld_vl ${BAREMETAL_SPI_SOURCES})
SET_TARGET_PROPERTIES(bm_spi_stm32spl_ld_vl PROPERTIES COMPILE_DEFINITIONS ${STM32_CHIP_DEF_LD_VL})

ADD_LIBRARY(bm_spi_stm32spl_md ${BAREMETAL_SPI_SOURCES})
SET_TARGET_PROPERTIES(bm_spi_stm32spl_md PROPERTIES COMPILE_DEFINITIONS ${STM32_CHIP_DEF_MD})

ADD_LIBRARY(bm_spi_stm32spl_md_vl ${BAREMETAL_SPI_SOURCES})
SET_TARGET_PROPERTIES(bm_spi_stm32spl_md_vl PROPERTIES COMPILE_DEFINITIONS ${STM32_CHIP_DEF_MD_VL})

ADD_LIBRARY(bm_spi_stm32spl_xl ${BAREMETAL_SPI_SOURCES})
SET_TARGET_PROPERTIES(bm_spi_stm32spl_xl PROPERTIES COMPILE_DEFINITIONS ${STM32_CHIP_DEF_XL})


INSTALL(TARGETS bm_spi_stm32spl_cl bm_spi_stm32spl_hd bm_spi_stm32spl_hd_vl bm_spi_stm32spl_md bm_spi_stm32spl_md_vl bm_spi_stm32spl_ld bm_spi_stm32spl_ld_vl bm_spi_stm32spl_xl
        RUNTIME DESTINATION bin LIBRARY DESTINATION lib ARCHIVE DESTINATION lib)